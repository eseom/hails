#!/usr/bin/env node

const spawn = require('child_process').spawn
const { systemLogger } = require('../lib/logger')

const command = process.argv[2]
const sequelizeCli = `${__dirname}/../node_modules/.bin/sequelize`

// map sequelize command
const execSequelize = (c) => {
  const call = spawn(sequelizeCli, [c])
  call.stdout.on('data', (data) => {
    systemLogger.info(data.toString().trim())
  })
  call.stderr.on('data', (data) => {
    systemLogger.error(data.toString().trim())
  })
}

switch (command) {
  case 'db:up':
    execSequelize('db:migrate')
    break
  case 'db:down':
    execSequelize('db:migrate:undo')
    break
  case 'db:status':
    execSequelize('db:migrate:status')
    break
  case 'db:create':
    execSequelize('migration:create')
    break
  case 'db:seed:up':
    execSequelize('db:seed:all')
    break
  case 'db:seed:down':
    execSequelize('db:seed:undo')
    break
  case 'db:seed:create':
    execSequelize('seed:create')
    break
  default:
    break
}
